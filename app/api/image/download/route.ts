import { NextRequest, NextResponse } from 'next/server'; import { publicUrlFor } from '@/lib/storage/r2'; export async function GET(req:NextRequest){ try{ const sp=new URL(req.url).searchParams; const url= sp.get('url') || (sp.get('key')? publicUrlFor(sp.get('key') as string): null); if(!url) return NextResponse.json({error:'url or key is required'},{status:400}); const r= await fetch(url); if(!r.ok) return NextResponse.json({error:'upstream '+r.status},{status:502}); const h=new Headers(r.headers); h.delete('content-security-policy'); return new NextResponse(r.body,{status:200, headers:h}); }catch(e:any){ return NextResponse.json({error:e?.message||'download error'}, {status:500}); } }
